<!-- extend base layout -->
{% extends "base.htm" %}

{% block head %}
<title>Results</title>
{% endblock %}


{% block body %}

<div class="page-header">
  <h1>Wyniki badań</h1>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

  google.charts.load('current', {'packages':['corechart']});
  google.charts.load('current', {'packages':['bar']});

  google.charts.setOnLoadCallback(draw_age_pie);
  google.charts.setOnLoadCallback(draw_home_pie);
  google.charts.setOnLoadCallback(draw_gender_pie);
  google.charts.setOnLoadCallback(draw_education_pie);
  google.charts.setOnLoadCallback(drawViewBars);
  google.charts.setOnLoadCallback(drawBadfeelingBars);

  function draw_age_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Wiek');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ ages|tojson }} );

     var options = {
          title: 'Wiek',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('age_donut'));
      chart.draw(data, options);
    }

  function draw_home_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Zamieszkanie');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ homes|tojson }} );

     var options = {
          title: 'Zamieszkanie',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('home_donut'));
      chart.draw(data, options);
    }

  function draw_gender_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Płeć');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ genders|tojson }} );

     var options = {
          title: 'Płeć',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('gender_donut'));
      chart.draw(data, options);
    }

  function draw_education_pie() {
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Wykształcenie');
    data.addColumn('number', 'Liczba osob');
    data.addRows( {{ educations|tojson }} );

    var options = {
         title: 'Wykształcenie',
         pieHole: 0.4,
         width: 400,
         height: 300
       };

    var chart = new google.visualization.PieChart(document.getElementById('education_donut'));
    chart.draw(data, options);
  }

    function drawViewBars() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Wiek');
        data.addColumn('number', 'Kilka razy dziennie')
        data.addColumn('number', 'Raz dziennie');
        data.addColumn('number', 'Raz na kilka dni');
        data.addColumn('number', 'Nie sprawdzam');
        data.addRows( {{ ages_view|tojson }} );

        var options = {
          chart: {
            title: 'Wiek a sprawdzanie aktualizacji o koronawirusie'
          },
          bars: 'vertical'
        };

        var chart = new google.charts.Bar(document.getElementById('ages_view'));

        chart.draw(data, google.charts.Bar.convertOptions(options));
      }

      function drawBadfeelingBars() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Wiek');
        data.addColumn('number', 'Ryzyko zachorowania moje lub bliskich');
        data.addColumn('number', 'Kryzys gospodarczy')
        data.addColumn('number', 'Nieodwracalne zmiany w relacjach społecznych');
        data.addColumn('number', 'Nic mnie nie niepokoi');
        data.addRows( {{ ages_badfeeling|tojson }} );

        var options = {
          chart: {
            title: 'Wiek a główne źródła niepokoju'
          },
          bars: 'vertical'
        };

        var chart = new google.charts.Bar(document.getElementById('ages_badfeeling'));

        chart.draw(data, google.charts.Bar.convertOptions(options));
      }
</script>



<div class="containerAll" style="align-items:center;
justify-content:center;
display:grid;
width: 100%;
high:100%;
grid-template-column: 400px 400px 200px;
grid-template-row: 300px 300px 1fr;">

  <div class="donuts" style="grid-row: 1 / 3;
grid-column: 1 / 3;
display:grid;
grid-template-column: repeat(2, 50%);
grid-template-row: repeat(2,50%);">
    <div class="donut1" id="age_donut" style="grid-column:1; grid-row:1;"></div>
    <div class="donut2" id="gender_donut" style="grid-column:2; grid-row:1;"></div>
    <div class="donut3" id="home_donut" style="grid-column:1; grid-row:2;"></div>
    <div class="donut4" id="education_donut" style="grid-column:2; grid-row:2;"></div>
  </div>

  <div class="face" style="grid-row: 1 / 3;grid-column: 3 / end;">
    <div class="chart1" id="face" style="width:50px;"></div>
    <div class="chart2" id="score"></div>
  </div>

  <div class="charts" style="grid-row: 3;
grid-column: 1 / end;
display:flex;
flex-direction:row;
flex-wrap: nowrap;">
    <div class="ages_view" id="ages_view"></div>
    <div class="ages_badfeeling" id="ages_badfeeling"></div>
  </div>

</div>

<script type="text/javascript">
function show_sentiment() {
    var image = ""
    if(( {{avg_sentiment}} >= -7) && ( {{avg_sentiment}} <0)) {
      image = "sad"
    }
    else if( {{avg_sentiment}} == 0) {
      image = "neutral"
    } else {
      image = "happy"
    }
    document.getElementById('face').src = "/static/images/" + image + ".png";

};
  show_sentiment();
</script>


<script type="text/javascript">
function show_score() {
    var score = {{ avg_score|string }}
    document.getElementById('score').value = score;
    if( {{avg_score}} < 5){
      document.getElementById('score').style.setProperty("--c", "red");
    }
    else if( {{avg_score}} == 5) {
      document.getElementById('score').style.setProperty("--c", "blue");
    } else {
      document.getElementById('score').style.setProperty("--c", "green");
    }
};
  show_score();
</script>
{% endblock %}