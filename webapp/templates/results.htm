<!-- extend base layout -->
{% extends "base.htm" %}

{% block head %}
<title>Results</title>
{% endblock %}


{% block body %}

<div class="page-header">
  <h1>Wyniki badań</h1>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

  google.charts.load('current', {'packages':['corechart']});
  google.charts.load('current', {'packages':['bar']});

  google.charts.setOnLoadCallback(draw_age_pie);
  google.charts.setOnLoadCallback(draw_home_pie);
  google.charts.setOnLoadCallback(draw_gender_pie);
  google.charts.setOnLoadCallback(draw_education_pie);
  google.charts.setOnLoadCallback(drawViewBars);
  google.charts.setOnLoadCallback(drawBadfeelingBars);

  function draw_age_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Wiek');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ ages|tojson }} );

     var options = {
          title: 'Wiek',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('age_donut'));
      chart.draw(data, options);
    }

  function draw_home_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Zamieszkanie');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ homes|tojson }} );

     var options = {
          title: 'Zamieszkanie',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('home_donut'));
      chart.draw(data, options);
    }

  function draw_gender_pie() {
     var data = new google.visualization.DataTable();
     data.addColumn('string', 'Płeć');
     data.addColumn('number', 'Liczba osob');
     data.addRows( {{ genders|tojson }} );

     var options = {
          title: 'Płeć',
          pieHole: 0.4,
          width: 400,
          height: 300
        };

      var chart = new google.visualization.PieChart(document.getElementById('gender_donut'));
      chart.draw(data, options);
    }

  function draw_education_pie() {
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Wykształcenie');
    data.addColumn('number', 'Liczba osob');
    data.addRows( {{ educations|tojson }} );

    var options = {
         title: 'Wykształcenie',
         pieHole: 0.4,
         width: 400,
         height: 300
       };

    var chart = new google.visualization.PieChart(document.getElementById('education_donut'));
    chart.draw(data, options);
  }

    function drawViewBars() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Wiek');
        data.addColumn('number', 'Kilka razy dziennie')
        data.addColumn('number', 'Raz dziennie');
        data.addColumn('number', 'Raz na kilka dni');
        data.addColumn('number', 'Nie sprawdzam');
        data.addRows( {{ ages_view|tojson }} );

        var options = {
          chart: {
            title: 'Wiek a sprawdzanie aktualizacji o koronawirusie'
          },
          bars: 'vertical'
        };

        var chart = new google.charts.Bar(document.getElementById('ages_view'));

        chart.draw(data, google.charts.Bar.convertOptions(options));
      }

      function drawBadfeelingBars() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Wiek');
        data.addColumn('number', 'Ryzyko zachorowania moje lub bliskich');
        data.addColumn('number', 'Kryzys gospodarczy')
        data.addColumn('number', 'Nieodwracalne zmiany w relacjach społecznych');
        data.addColumn('number', 'Nic mnie nie niepokoi');
        data.addRows( {{ ages_badfeeling|tojson }} );

        var options = {
          chart: {
            title: 'Wiek a główne źródła niepokoju'
          },
          bars: 'vertical'
        };

        var chart = new google.charts.Bar(document.getElementById('ages_badfeeling'));

        chart.draw(data, google.charts.Bar.convertOptions(options));
      }
</script>

<div class="container">
  <div class="row">
    <div class="col" id="age_donut" style="width: 25vh;padding: 0;margin: 0;"></div>
    <div class="col" id="gender_donut" style="width: 25vh;padding: 0;margin: 0;"></div>
  </div>
  <div class="row">
    <div class="col" id="home_donut" style="width: 25vh;padding: ;margin: 0;"></div>
    <div class="col" id="education_donut" style="width: 25vh;padding: 0;margin: 0;"></div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col" id="ages_view" style="width: 40vh;height: 40vh;padding: 20;margin: 10;"></div>
    <div class="col" id="ages_badfeeling" style="width: 40vh;height: 40vh;padding: 20;margin: 10;"></div>
  </div>
</div>
<br>
<div class="container">
  <div class="row">
    <div class="col">
      <label for="face">Ogólne odczucia wszystkich zbadanych</label>
      <img class="img-circle" src="" id="face" style="height: 100px; border-radius: 50%; background-color white">
    </div>
    <div class="col">
      <label for="score">Średnia ocena działań rządu</label>
      <progress max="10" id="score" value=""></progress>
    </div>
  </div>
</div>

<script type="text/javascript">
function show_sentiment() {
    var image = ""
    if(( {{avg_sentiment}} >= -7) && ( {{avg_sentiment}} <0)) {
      image = "sad"
    }
    else if( {{avg_sentiment}} == 0) {
      image = "neutral"
    } else {
      image = "happy"
    }
    document.getElementById('face').src = "/static/images/" + image + ".png";

};
  show_sentiment();
</script>


<script type="text/javascript">
function show_score() {
    var score = {{ avg_score|string }}
    document.getElementById('score').value = score;
    if( {{avg_score}} < 5){
      document.getElementById('score').style.setProperty("--c", "red");
    }
    else if( {{avg_score}} == 5) {
      document.getElementById('score').style.setProperty("--c", "blue");
    } else {
      document.getElementById('score').style.setProperty("--c", "green");
    }
};
  show_score();
</script>
{% endblock %}